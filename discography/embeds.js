const EMBEDS_JS_T = {
    mute: 'Mute',
    playbackPosition: 'Playback position',
    unmute: 'Unmute',
    volume: 'Volume',
    xxxHours: hours => '{xxx} hours'.replace('{xxx}', hours),
    xxxMinutes: minutes => '{xxx} minutes'.replace('{xxx}', minutes),
    xxxSeconds: seconds => '{xxx} seconds'.replace('{xxx}', seconds)
};
const loadingIcon=document.querySelector(`#loading_icon`).content,pauseIcon=document.querySelector(`#pause_icon`).content,playIcon=document.querySelector(`#play_icon`).content;let activeTrack;const tracks=[],playerContainer=document.querySelector(`.player`),player={container:playerContainer,currentTime:playerContainer.querySelector(`.time .current`),nextTrackButton:playerContainer.querySelector(`button.next_track`),number:playerContainer.querySelector(`.number`),playbackButton:playerContainer.querySelector(`button.playback`),previousTrackButton:playerContainer.querySelector(`button.previous_track`),progress:playerContainer.querySelector(`.progress`),speedButton:playerContainer.querySelector(`button.speed`),speedMultiplier:playerContainer.querySelector(`button.speed .multiplier`),timeline:playerContainer.querySelector(`.timeline`),timelineInput:playerContainer.querySelector(`.timeline input`),titleWrapper:playerContainer.querySelector(`.title_wrapper`),totalTime:playerContainer.querySelector(`.time .total`),volume:{container:playerContainer.querySelector(`.volume`),knob:playerContainer.querySelector(`.volume button`),knobSvgTitle:playerContainer.querySelector(`.volume button svg title`),slider:playerContainer.querySelector(`.volume .slider`),sliderInput:playerContainer.querySelector(`.volume .slider input`),sliderSvg:playerContainer.querySelector(`.volume .slider svg`)}};let globalUpdatePlayHeadInterval,speed=100;const volume={finegrained:!1,level:1};let volumeProbe=new Audio;const volumeProbeHandler=()=>{player.volume.container.classList.add(`finegrained`),volume.finegrained=!0,updateVolume(!1),volumeProbe.removeEventListener(`volumechange`,volumeProbeHandler),volumeProbe=null};volumeProbe.addEventListener(`volumechange`,volumeProbeHandler),volumeProbe.volume=.123;const persistedVolume=localStorage.getItem(`faircampEmbedVolume`);if(persistedVolume!==null){let e=parseFloat(persistedVolume);e>=0&&e<=1&&(volume.level=e)}updateVolume(!1);function announcePlayhead(e){let p=`${EMBEDS_JS_T.playbackPosition} ${formatTimeWrittenOut(e.input.value)}`;player.timelineInput.setAttribute(`aria-valuetext`,p)}function formatTime(e){if(e<60)return`0:${Math.floor(e).toString().padStart(2,`0`)}`;{let p=Math.floor(e%60).toString().padStart(2,`0`);return e<3600?`${Math.floor(e/60)}:${p}`:`${Math.floor(e/3600)}:${Math.floor(e%3600/60).toString().padStart(2,`0`)}:${p}`}}function formatTimeWrittenOut(e){if(e<60)return EMBEDS_JS_T.xxxSeconds(Math.floor(e));{let p=EMBEDS_JS_T.xxxSeconds(Math.floor(Math.floor(e%60)));return e<3600?`${EMBEDS_JS_T.xxxMinutes(Math.floor(e/60))} ${p}`:`${EMBEDS_JS_T.xxxHours(Math.floor(e/3600))} ${EMBEDS_JS_T.xxxMinutes(Math.floor(e%3600/60))} ${p}`}}function open(e){if(player.currentTime.textContent=formatTime(e.seekTo??e.audio.currentTime),player.totalTime.textContent=formatTime(e.duration),player.timelineInput.max=e.container.dataset.duration,e.artists?player.titleWrapper.replaceChildren(e.title.cloneNode(!0),e.artists.cloneNode(!0)):player.titleWrapper.replaceChildren(e.title.cloneNode(!0)),player.number&&(player.nextTrackButton.toggleAttribute(`disabled`,!e.nextTrack),player.number.textContent=e.number.textContent,player.previousTrackButton.toggleAttribute(`disabled`,!e.previousTrack)),e.seekTo!==void 0&&e.seekTo>0){let p=e.seekTo/e.duration;player.progress.style.setProperty(`width`,`${p*100}%`),player.currentTime.textContent=formatTime(e.seekTo),player.timelineInput.value=e.seekTo}e.open=!0}function parseHashParams(){if(location.hash.length===0)return null;let e=new URLSearchParams(location.hash.substring(1)),p=e.get(`t`)??e.get(`time`),m=e.get(`n`)??e.get(`track`);if(p===null&&m===null)return null;let h={};if(m===null)h.track=tracks[0];else if(m.match(/^[0-9]+$/)){let e=parseInt(m)-1;e<tracks.length&&(h.track=tracks[e])}if(!h.track)return null;if(p!==null){let e=p.match(/^(?:([0-9]+)h)?(?:([0-9]+)m)?(?:([0-9]+)s?)?$/);if(e){h.time=0;let[p,m,g,_]=e;if(m&&(h.time+=parseInt(m)*3600),g&&(h.time+=parseInt(g)*60),_&&(h.time+=parseInt(_)),h.time>h.track.duration)return null}else return null}return h}function play(p){p.open||open(p),p.audio.preload!==`auto`&&(p.audio.preload=`auto`,p.audio.load()),player.playbackButton.replaceChildren(loadingIcon.cloneNode(!0));let m=()=>{p.solicitedPlayback=!0,setVolume(p),p.audio.play()};p.seekTo===void 0?m():seek(p,m)}function requestPlaybackChange(e){if(e===activeTrack)e.seeking?e.seeking.cancel():e.audio.paused?play(e):e.audio.pause();else{let p=()=>{setActive(e),play(e)};reset(activeTrack,p)}}function requestSeek(e,p){if(e===activeTrack)e.seeking?e.seekTo=p:e.audio.paused?(e.seekTo=p,play(e)):(e.audio.currentTime=p,updatePlayhead(e),announcePlayhead(e));else{let m=()=>{setActive(e),e.seekTo=p,play(e)};reset(activeTrack,m)}}function reset(e,p=null){let m=()=>{e.open&&(e.audio.currentTime=0,updatePlayhead(e,!0),announcePlayhead(e),e.open=!1),delete e.seekTo,p!==null&&p()};e.seeking?(e.seeking.cancel(),m()):e.audio.paused?m():(e.onPause=m,e.audio.pause())}function seek(e,p=null){let h={onComplete:p},g=0;function _(){let p=0,{seekable:m}=e.audio;for(let h=0;h<m.length&&m.start(h)<=e.seekTo;h++)if(m.end(h)>=e.seekTo){e.audio.currentTime=e.seekTo;let{onComplete:p}=e.seeking;delete e.seeking,delete e.seekTo,clearInterval(y),p!==null&&p()}else p=m.end(h);e.seeking&&p-g>1&&(e.audio.currentTime=p,g=p)}let y=setInterval(_,30);h.cancel=()=>{clearInterval(y),delete e.seeking,player.playbackButton.replaceChildren(playIcon.cloneNode(!0))},e.seeking=h}function setActive(e){activeTrack=e}function setSpeed(e){e.audio.playbackRate=speed/100}function setVolume(e){volume.finegrained?(e.audio.muted=!1,e.audio.volume=volume.level):e.audio.muted=volume.level===0}function toggleMute(){volume.level>0?(volume.restoreLevel=volume.level,volume.level=0):volume.restoreLevel?(volume.level=volume.restoreLevel,delete volume.restoreLevel):volume.level=1,updateVolume()}function updatePlayhead(e,p=!1){let{audio:m}=e,h=p?0:m.currentTime/e.duration;player.progress.style.setProperty(`width`,`${h*100}%`),player.currentTime.textContent=formatTime(m.currentTime),player.timelineInput.value=m.currentTime}function updateSpeed(){player.speedMultiplier.textContent=(speed/100).toFixed(1),setSpeed(activeTrack)}function updateVolume(e=!0){activeTrack&&activeTrack.solicitedPlayback&&setVolume(activeTrack);let p=32,m=e=>e*Math.PI/180,g=(e,h)=>{let g=h<180?0:1,_=m(e),v=Math.sin(_),y=-Math.cos(_),b=m(e+h),x=Math.sin(b),S=-Math.cos(b),C=p,w=p+v*C,T=p+y*C,E=p+x*C,D=p+S*C,O=p*.8,k=p+v*O,A=p+y*O,j=p+x*O,M=p+S*O;return`
            M ${w},${T}
            A ${C} ${C} 0 ${g} 1 ${E},${D}
            L ${j},${M}
            A ${O} ${O} 0 ${g} 0 ${k},${A}
            Z
        `},_=volume.finegrained?volume.level:volume.level>0?1:0;player.volume.knob.classList.toggle(`muted`,_===0),player.volume.knobSvgTitle.textContent=_>0?EMBEDS_JS_T.mute:EMBEDS_JS_T.unmute;let y=-135,b=_*270,S=y+b;player.volume.knob.querySelector(`path.knob`).setAttribute(`transform`,`rotate(${S} 32 32)`);let C=_>0?g(y,b):``;player.volume.knob.querySelector(`path.active_range`).setAttribute(`d`,C);let w=_<1?g(y+b,270-b):``;player.volume.knob.querySelector(`path.inactive_range`).setAttribute(`d`,w);let T=_*100,E=T%1>.1?Math.trunc(T*10)/10:Math.trunc(T);player.volume.sliderInput.setAttribute(`aria-valuetext`,`${EMBEDS_JS_T.volume} ${E}%`),player.volume.sliderInput.value=_,player.volume.slider.querySelector(`linearGradient#gradient_level stop:nth-child(1)`).setAttribute(`offset`,_),player.volume.slider.querySelector(`linearGradient#gradient_level stop:nth-child(2)`).setAttribute(`offset`,_+1e-4),player.volume.slider.classList.remove(`decrease`,`increase`),e&&localStorage.setItem(`faircampEmbedVolume`,volume.level.toString())}player.container.addEventListener(`keydown`,e=>{if(e.target!==player.volume.sliderInput){if(e.key===`ArrowLeft`){e.preventDefault();let p=Math.max(0,activeTrack.audio.currentTime-5);requestSeek(activeTrack,p)}else if(e.key===`ArrowRight`){e.preventDefault();let p=Math.min(activeTrack.duration-1,activeTrack.audio.currentTime+5);requestSeek(activeTrack,p)}}}),player.playbackButton.addEventListener(`click`,()=>{requestPlaybackChange(activeTrack)}),player.nextTrackButton&&player.nextTrackButton.addEventListener(`click`,()=>{activeTrack?.nextTrack&&requestPlaybackChange(activeTrack.nextTrack)}),player.previousTrackButton&&player.previousTrackButton.addEventListener(`click`,()=>{activeTrack?.previousTrack&&requestPlaybackChange(activeTrack.previousTrack)}),player.speedButton&&(player.speedButton.addEventListener(`auxclick`,e=>{e.preventDefault(),speed=100,updateSpeed()}),player.speedButton.addEventListener(`click`,()=>{speed=speed<100?100:speed<120?120:speed<140?140:speed<160?160:speed<180?180:speed<200?200:100,updateSpeed()}),player.speedButton.addEventListener(`contextmenu`,e=>e.preventDefault()),player.speedButton.addEventListener(`keydown`,e=>{if(e.key===`ArrowDown`&&speed>30)speed-=10;else if(e.key===`ArrowUp`&&speed<300)speed+=10;else return;updateSpeed(),e.preventDefault(),e.stopPropagation()}),player.speedButton.addEventListener(`wheel`,()=>{event.deltaY<0&&speed<300?speed+=10:event.deltaY>0&&speed>30&&(speed-=10),updateSpeed()})),player.timeline.addEventListener(`click`,()=>{let e=(event.clientX-player.timeline.getBoundingClientRect().x)/player.timeline.getBoundingClientRect().width,p=e*player.timelineInput.max;requestSeek(activeTrack,p),player.timeline.classList.add(`focus_from_click`),player.timelineInput.focus()}),player.timelineInput.addEventListener(`blur`,()=>{player.timeline.classList.remove(`focus`,`focus_from_click`)}),player.timelineInput.addEventListener(`focus`,()=>{player.timeline.classList.add(`focus`)}),player.timelineInput.addEventListener(`keydown`,e=>{(e.key===` `||e.key===`Enter`)&&(e.preventDefault(),requestPlaybackChange(activeTrack))}),player.volume.container.addEventListener(`auxclick`,e=>{e.preventDefault(),volume.level=volume.level<1?1:0,updateVolume()}),player.volume.container.addEventListener(`contextmenu`,e=>e.preventDefault()),player.volume.container.addEventListener(`mouseenter`,()=>{player.volume.container.classList.add(`hover`)}),player.volume.container.addEventListener(`mouseleave`,()=>{player.volume.container.classList.remove(`hover`),player.volume.slider.classList.remove(`decrease`,`increase`)}),player.volume.container.addEventListener(`wheel`,e=>{e.preventDefault(),volume.finegrained?(volume.level+=e.deltaY*-1e-4,volume.level>1?volume.level=1:volume.level<0&&(volume.level=0)):e.deltaY<0?volume.level=1:e.deltaY>0&&(volume.level=0),updateVolume()}),player.volume.knob.addEventListener(`click`,()=>toggleMute()),player.volume.knob.addEventListener(`keydown`,e=>{if(e.key===`ArrowDown`)volume.level-=.02;else if(e.key===`ArrowUp`)volume.level+=.02;else return;volume.level>1?volume.level=1:volume.level<0&&(volume.level=0),updateVolume(),e.preventDefault(),e.stopPropagation()}),player.volume.slider.addEventListener(`mousedown`,e=>{if(e.button===0){let p=e=>{let p=player.volume.sliderSvg.getBoundingClientRect(),m=Math.min(Math.max(0,e.clientX-p.x),p.width);volume.level=m/p.width,updateVolume()};p(e),window.addEventListener(`mousemove`,p),player.volume.slider.classList.add(`dragging`),window.addEventListener(`mouseup`,()=>{window.removeEventListener(`mousemove`,p),player.volume.slider.classList.remove(`dragging`)},{once:!0})}}),player.volume.slider.addEventListener(`mousemove`,e=>{let p=player.volume.sliderSvg.getBoundingClientRect(),m=Math.min(Math.max(0,e.clientX-p.x),p.width),h=m/p.width;h>volume.level?(player.volume.slider.classList.remove(`decrease`),player.volume.slider.classList.add(`increase`),player.volume.slider.querySelector(`linearGradient#gradient_level_increase stop:nth-child(1)`).setAttribute(`offset`,h),player.volume.slider.querySelector(`linearGradient#gradient_level_increase stop:nth-child(2)`).setAttribute(`offset`,h+1e-4)):(player.volume.slider.classList.remove(`increase`),player.volume.slider.classList.add(`decrease`),player.volume.slider.querySelector(`linearGradient#gradient_level_decrease stop:nth-child(1)`).setAttribute(`offset`,h),player.volume.slider.querySelector(`linearGradient#gradient_level_decrease stop:nth-child(2)`).setAttribute(`offset`,h+1e-4))}),player.volume.sliderInput.addEventListener(`blur`,()=>{player.volume.slider.classList.remove(`focus`)}),player.volume.sliderInput.addEventListener(`focus`,()=>{player.volume.slider.classList.add(`focus`)}),player.volume.sliderInput.addEventListener(`input`,()=>{volume.level=parseFloat(player.volume.sliderInput.valueAsNumber),updateVolume()}),player.volume.sliderInput.addEventListener(`keydown`,e=>{if(e.key===`ArrowLeft`||e.key===`ArrowDown`)volume.level-=.02;else if(e.key===`ArrowRight`||e.key===`ArrowUp`)volume.level+=.02;else if(e.key===`Enter`||e.key===` `)toggleMute();else return;volume.level>1?volume.level=1:volume.level<0&&(volume.level=0),updateVolume(),e.preventDefault()}),player.volume.sliderInput.addEventListener(`wheel`,e=>e.preventDefault()),navigator.mediaSession&&(navigator.mediaSession.setActionHandler(`play`,()=>{requestPlaybackChange(activeTrack)}),navigator.mediaSession.setActionHandler(`pause`,()=>{requestPlaybackChange(activeTrack)}));let previousTrack=null,trackIndex=0;for(let h of document.querySelectorAll(`.track`)){let _=h.querySelector(`.artists`),b=h.querySelector(`audio`),x=h.querySelector(`input`),S=h.querySelector(`.number`),C=h.querySelector(`.title`),w=parseFloat(h.dataset.duration),E={artists:_,audio:b,container:h,duration:w,input:x,number:S,title:C};b.muted=!0,previousTrack!==null&&(previousTrack.nextTrack=E,E.previousTrack=previousTrack),previousTrack=E,b.addEventListener(`ended`,e=>{b.currentTime=0,h.classList.remove(`active`,`playing`),E.nextTrack?requestPlaybackChange(E.nextTrack):(reset(E),setActive(tracks[0]),open(tracks[0]))}),b.addEventListener(`pause`,e=>{E.solicitedPlayback&&(delete E.solicitedPlayback,E.audio.muted=!0,clearInterval(globalUpdatePlayHeadInterval),h.classList.remove(`playing`),player.playbackButton.replaceChildren(playIcon.cloneNode(!0)),E.onPause?(E.onPause(),delete E.onPause):(updatePlayhead(E),announcePlayhead(E)))}),b.addEventListener(`play`,e=>{if(!E.solicitedPlayback){b.pause();return}h.classList.add(`playing`),player.playbackButton.replaceChildren(pauseIcon.cloneNode(!0)),globalUpdatePlayHeadInterval=setInterval(()=>updatePlayhead(E),1e3/24),updatePlayhead(E),announcePlayhead(E)}),b.addEventListener(`playing`,e=>{E.solicitedPlayback&&player.playbackButton.replaceChildren(pauseIcon.cloneNode(!0))}),b.addEventListener(`waiting`,p=>{E.solicitedPlayback&&player.playbackButton.replaceChildren(loadingIcon.cloneNode(!0))}),h.addEventListener(`keydown`,e=>{if(e.key===`ArrowLeft`){e.preventDefault();let p=Math.max(0,E.audio.currentTime-5);requestSeek(E,p)}else if(e.key===`ArrowRight`){e.preventDefault();let p=Math.min(E.duration-1,E.audio.currentTime+5);requestSeek(E,p)}}),trackIndex++,tracks.push(E)}window.addEventListener(`keydown`,e=>{if(e.key===`m`){let{target:p}=e;(p.tagName!==`INPUT`||p.type!==`search`&&p.type!==`text`)&&(toggleMute(),e.preventDefault())}});const params=parseHashParams();params?(setActive(params.track),params.time!==void 0&&(params.track.seekTo=params.time)):setActive(tracks[0]),open(activeTrack);