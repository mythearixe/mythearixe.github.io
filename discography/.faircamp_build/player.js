const PLAYER_JS_T = {
    listen: 'Listen',
    mute: 'Mute',
    pause: 'Pause',
    playbackPosition: 'Playback position',
    playerClosed: 'Player closed',
    playerOpenPlayingXxx: title => 'Player open, playing {title}'.replace('{title}', title),
    playerOpenWithXxx: title => 'Player open with {title}'.replace('{title}', title),
    unmute: 'Unmute',
    volume: 'Volume',
    xxxHours: hours => '{xxx} hours'.replace('{xxx}', hours),
    xxxMinutes: minutes => '{xxx} minutes'.replace('{xxx}', minutes),
    xxxSeconds: seconds => '{xxx} seconds'.replace('{xxx}', seconds)
};
const BREAKPOINT_REDUCED_WAVEFORM_REM=20,TRACK_HEIGHT_EM=1.5,WAVEFORM_PADDING_EM=.3,WAVEFORM_HEIGHT=TRACK_HEIGHT_EM-WAVEFORM_PADDING_EM*2,WAVEFORM_WIDTH_PADDING_REM=5,WAVEFORM_WIDTH_TOLERANCE_REM=2.5,loadingIcon=document.querySelector(`#loading_icon`).content,pauseIcon=document.querySelector(`#pause_icon`).content,playIcon=document.querySelector(`#play_icon`).content,listenButton=document.querySelector(`button.listen`),listenButtonIcon=document.querySelector(`button.listen .icon`),listenButtonLabel=document.querySelector(`button.listen .label`);let activeTrack;const tracks=[],dockedPlayerContainer=document.querySelector(`.docked_player`),dockedPlayer={container:dockedPlayerContainer,currentTime:dockedPlayerContainer.querySelector(`.time .current`),nextTrackButton:dockedPlayerContainer.querySelector(`button.next_track`),number:dockedPlayerContainer.querySelector(`.number`),playbackButton:dockedPlayerContainer.querySelector(`button.playback`),progress:dockedPlayerContainer.querySelector(`.progress`),speedButton:dockedPlayerContainer.querySelector(`button.speed`),speedMultiplier:dockedPlayerContainer.querySelector(`button.speed .multiplier`),status:document.querySelector(`.docked_player_status`),timeline:dockedPlayerContainer.querySelector(`.timeline`),timelineInput:dockedPlayerContainer.querySelector(`.timeline input`),titleWrapper:dockedPlayerContainer.querySelector(`.title_wrapper`),totalTime:dockedPlayerContainer.querySelector(`.time .total`),volume:{container:dockedPlayerContainer.querySelector(`.volume`),knob:dockedPlayerContainer.querySelector(`.volume button`),knobSvgTitle:dockedPlayerContainer.querySelector(`.volume button svg title`),slider:dockedPlayerContainer.querySelector(`.volume .slider`),sliderInput:dockedPlayerContainer.querySelector(`.volume .slider input`),sliderSvg:dockedPlayerContainer.querySelector(`.volume .slider svg`)}};let globalUpdatePlayHeadInterval,speed=100;const volume={finegrained:!1,level:1};let volumeProbe=new Audio;const volumeProbeHandler=()=>{dockedPlayer.volume.container.classList.add(`finegrained`),volume.finegrained=!0,updateVolume(!1),volumeProbe.removeEventListener(`volumechange`,volumeProbeHandler),volumeProbe=null};volumeProbe.addEventListener(`volumechange`,volumeProbeHandler),volumeProbe.volume=.123;const persistedVolume=localStorage.getItem(`faircampVolume`);if(persistedVolume!==null){let i=parseFloat(persistedVolume);i>=0&&i<=1&&(volume.level=i)}updateVolume(!1);function announcePlayhead(i){let O=`${PLAYER_JS_T.playbackPosition} ${formatTimeWrittenOut(dockedPlayer.timelineInput.value)}`;dockedPlayer.timelineInput.setAttribute(`aria-valuetext`,O),i.waveform&&i.waveform.input.setAttribute(`aria-valuetext`,O)}function decode(i){let O=[];for(let k=0;k<i.length;k++){let A=i.charCodeAt(k);A>=65&&A<=90?O.push(A-65):A>=97&&A<=122?O.push(A-71):A>48&&A<57?O.push(A+4):A===43?O.push(62):A===48&&O.push(63)}return O}function formatTime(i){if(i<60)return`0:${Math.floor(i).toString().padStart(2,`0`)}`;{let O=Math.floor(i%60).toString().padStart(2,`0`);return i<3600?`${Math.floor(i/60)}:${O}`:`${Math.floor(i/3600)}:${Math.floor(i%3600/60).toString().padStart(2,`0`)}:${O}`}}function formatTimeWrittenOut(i){if(i<60)return PLAYER_JS_T.xxxSeconds(Math.floor(i));{let O=PLAYER_JS_T.xxxSeconds(Math.floor(Math.floor(i%60)));return i<3600?`${PLAYER_JS_T.xxxMinutes(Math.floor(i/60))} ${O}`:`${PLAYER_JS_T.xxxHours(Math.floor(i/3600))} ${PLAYER_JS_T.xxxMinutes(Math.floor(i%3600/60))} ${O}`}}function hoverAvailable(){return window.matchMedia(`(hover: hover)`).matches}function open(i){if(document.body.classList.add(`player_active`),dockedPlayer.currentTime.textContent=formatTime(i.seekTo??i.audio.currentTime),dockedPlayer.totalTime.textContent=formatTime(i.duration),dockedPlayer.timelineInput.max=i.container.dataset.duration,i.artists?dockedPlayer.titleWrapper.replaceChildren(i.title.cloneNode(!0),i.artists.cloneNode(!0)):dockedPlayer.titleWrapper.replaceChildren(i.title.cloneNode(!0)),dockedPlayer.number&&(dockedPlayer.nextTrackButton.toggleAttribute(`disabled`,!i.nextTrack),dockedPlayer.number.textContent=i.number.textContent),i.seekTo!==void 0&&i.seekTo>0){let O=i.seekTo/i.duration;dockedPlayer.progress.style.setProperty(`width`,`${O*100}%`),dockedPlayer.currentTime.textContent=formatTime(i.seekTo),dockedPlayer.timelineInput.value=i.seekTo,i.waveform&&(i.waveform.svg.querySelector(`linearGradient.playback stop:nth-child(1)`).setAttribute(`offset`,O),i.waveform.svg.querySelector(`linearGradient.playback stop:nth-child(2)`).setAttribute(`offset`,O+1e-4),i.waveform.input.value=i.seekTo)}i.open=!0}function parseHashParams(){if(location.hash.length===0)return null;let i=new URLSearchParams(location.hash.substring(1)),O=i.get(`t`)??i.get(`time`),k=i.get(`n`)??i.get(`track`);if(O===null&&k===null)return null;let A={};if(k===null)A.track=tracks[0];else if(k.match(/^[0-9]+$/)){let i=parseInt(k)-1;i<tracks.length&&(A.track=tracks[i])}if(!A.track)return null;if(O!==null){let i=O.match(/^(?:([0-9]+)h)?(?:([0-9]+)m)?(?:([0-9]+)s?)?$/);if(i){A.time=0;let[O,k,j,M]=i;if(k&&(A.time+=parseInt(k)*3600),j&&(A.time+=parseInt(j)*60),M&&(A.time+=parseInt(M)),A.time>A.track.duration)return null}else return null}return A}function play(i){i.open||(open(i),dockedPlayer.status.setAttribute(`aria-label`,PLAYER_JS_T.playerOpenPlayingXxx(i.title.textContent))),i.audio.preload!==`auto`&&(i.audio.preload=`auto`,i.audio.load()),i.playbackButtonIcon.replaceChildren(loadingIcon.cloneNode(!0)),dockedPlayer.playbackButton.replaceChildren(loadingIcon.cloneNode(!0)),listenButtonIcon.replaceChildren(loadingIcon.cloneNode(!0)),listenButtonLabel.textContent=PLAYER_JS_T.pause;let O=()=>{i.solicitedPlayback=!0,setSpeed(i),setVolume(i),i.audio.play()};i.seekTo===void 0?O():seek(i,O)}function requestPlaybackChange(i){if(i===activeTrack)i.seeking?i.seeking.cancel():i.audio.paused?play(i):i.audio.pause();else{let O=()=>{setActive(i),play(i)};reset(activeTrack,O)}}function requestSeek(i,O){if(i===activeTrack)i.seeking?i.seekTo=O:i.audio.paused?(i.seekTo=O,play(i)):(i.audio.currentTime=O,updatePlayhead(i),announcePlayhead(i));else{let k=()=>{setActive(i),i.seekTo=O,play(i)};reset(activeTrack,k)}}function reset(i,O=null){let k=()=>{i.container.classList.remove(`active`),i.open&&(i.audio.currentTime=0,updatePlayhead(i,!0),announcePlayhead(i),i.open=!1),delete i.seekTo,O!==null&&O()};i.seeking?(i.seeking.cancel(),k()):i.audio.paused?k():(i.onPause=k,i.audio.pause())}function seek(i,O=null){let k={onComplete:O},A=0;function j(){let O=0,{seekable:k}=i.audio;for(let A=0;A<k.length&&k.start(A)<=i.seekTo;A++)if(k.end(A)>=i.seekTo){i.audio.currentTime=i.seekTo;let{onComplete:O}=i.seeking;delete i.seeking,delete i.seekTo,clearInterval(M),O!==null&&O()}else O=k.end(A);i.seeking&&O-A>1&&(i.audio.currentTime=O,A=O)}let M=setInterval(j,30);k.cancel=()=>{clearInterval(M),delete i.seeking,dockedPlayer.playbackButton.replaceChildren(playIcon.cloneNode(!0)),i.container.classList.remove(`active`),i.playbackButtonIcon.replaceChildren(playIcon.cloneNode(!0)),listenButtonIcon.replaceChildren(playIcon.cloneNode(!0)),listenButtonLabel.textContent=PLAYER_JS_T.listen},i.seeking=k}function setActive(i){activeTrack=i,i.container.classList.add(`active`)}function setSpeed(i){i.audio.playbackRate=speed/100}function setVolume(i){volume.finegrained?(i.audio.muted=!1,i.audio.volume=volume.level):i.audio.muted=volume.level===0}function toggleMute(){volume.level>0?(volume.restoreLevel=volume.level,volume.level=0):volume.restoreLevel?(volume.level=volume.restoreLevel,delete volume.restoreLevel):volume.level=1,updateVolume()}function updatePlayhead(i,O=!1){let{audio:k}=i,A=O?0:k.currentTime/i.duration;dockedPlayer.progress.style.setProperty(`width`,`${A*100}%`),dockedPlayer.currentTime.textContent=formatTime(k.currentTime),dockedPlayer.timelineInput.value=k.currentTime,i.waveform&&(i.waveform.svg.querySelector(`linearGradient.playback stop:nth-child(1)`).setAttribute(`offset`,A),i.waveform.svg.querySelector(`linearGradient.playback stop:nth-child(2)`).setAttribute(`offset`,A+1e-4),i.waveform.input.value=k.currentTime)}function updateSpeed(){dockedPlayer.speedMultiplier.textContent=(speed/100).toFixed(1),setSpeed(activeTrack)}function updateVolume(i=!0){activeTrack&&activeTrack.solicitedPlayback&&setVolume(activeTrack);let O=32,k=i=>i*Math.PI/180,A=(i,A)=>{let j=A<180?0:1,M=k(i),N=Math.sin(M),P=-Math.cos(M),F=k(i+A),I=Math.sin(F),L=-Math.cos(F),R=O,z=O+N*R,B=O+P*R,V=O+I*R,H=O+L*R,U=O*.8,W=O+N*U,G=O+P*U,K=O+I*U,q=O+L*U;return`
            M ${z},${B}
            A ${R} ${R} 0 ${j} 1 ${V},${H}
            L ${K},${q}
            A ${U} ${U} 0 ${j} 0 ${W},${G}
            Z
        `},j=volume.finegrained?volume.level:volume.level>0?1:0;dockedPlayer.volume.knob.classList.toggle(`muted`,j===0),dockedPlayer.volume.knobSvgTitle.textContent=j>0?PLAYER_JS_T.mute:PLAYER_JS_T.unmute;let M=-135,N=j*270,P=M+N;dockedPlayer.volume.knob.querySelector(`path.knob`).setAttribute(`transform`,`rotate(${P} 32 32)`);let F=j>0?A(M,N):``;dockedPlayer.volume.knob.querySelector(`path.active_range`).setAttribute(`d`,F);let I=j<1?A(M+N,270-N):``;dockedPlayer.volume.knob.querySelector(`path.inactive_range`).setAttribute(`d`,I);let L=j*100,R=L%1>.1?Math.trunc(L*10)/10:Math.trunc(L);dockedPlayer.volume.sliderInput.setAttribute(`aria-valuetext`,`${PLAYER_JS_T.volume} ${R}%`),dockedPlayer.volume.sliderInput.value=j,dockedPlayer.volume.slider.querySelector(`linearGradient#gradient_level stop:nth-child(1)`).setAttribute(`offset`,j),dockedPlayer.volume.slider.querySelector(`linearGradient#gradient_level stop:nth-child(2)`).setAttribute(`offset`,j+1e-4),dockedPlayer.volume.slider.classList.remove(`decrease`,`increase`),i&&localStorage.setItem(`faircampVolume`,volume.level.toString())}dockedPlayer.container.addEventListener(`keydown`,i=>{if(i.target!==dockedPlayer.volume.sliderInput){if(i.key===`ArrowLeft`){i.preventDefault();let O=Math.max(0,activeTrack.audio.currentTime-5);requestSeek(activeTrack,O)}else if(i.key===`ArrowRight`){i.preventDefault();let O=Math.min(activeTrack.duration-1,activeTrack.audio.currentTime+5);requestSeek(activeTrack,O)}}}),dockedPlayer.playbackButton.addEventListener(`click`,()=>{requestPlaybackChange(activeTrack)}),dockedPlayer.nextTrackButton&&dockedPlayer.nextTrackButton.addEventListener(`click`,()=>{activeTrack.nextTrack&&requestPlaybackChange(activeTrack.nextTrack)}),dockedPlayer.speedButton&&(dockedPlayer.speedButton.addEventListener(`auxclick`,i=>{i.preventDefault(),speed=100,updateSpeed()}),dockedPlayer.speedButton.addEventListener(`click`,()=>{speed=speed<100?100:speed<120?120:speed<140?140:speed<160?160:speed<180?180:speed<200?200:100,updateSpeed()}),dockedPlayer.speedButton.addEventListener(`contextmenu`,i=>i.preventDefault()),dockedPlayer.speedButton.addEventListener(`keydown`,i=>{if(i.key===`ArrowDown`&&speed>30)speed-=10;else if(i.key===`ArrowUp`&&speed<300)speed+=10;else return;updateSpeed(),i.preventDefault(),i.stopPropagation()}),dockedPlayer.speedButton.addEventListener(`wheel`,i=>{i.deltaY<0&&speed<300?speed+=10:i.deltaY>0&&speed>30&&(speed-=10),updateSpeed(),i.preventDefault()})),dockedPlayer.timeline.addEventListener(`click`,()=>{let i=(event.clientX-dockedPlayer.timeline.getBoundingClientRect().x)/dockedPlayer.timeline.getBoundingClientRect().width,O=i*dockedPlayer.timelineInput.max;requestSeek(activeTrack,O),dockedPlayer.timeline.classList.add(`focus_from_click`),dockedPlayer.timelineInput.focus()}),dockedPlayer.timelineInput.addEventListener(`blur`,()=>{dockedPlayer.timeline.classList.remove(`focus`,`focus_from_click`)}),dockedPlayer.timelineInput.addEventListener(`focus`,()=>{dockedPlayer.timeline.classList.add(`focus`)}),dockedPlayer.timelineInput.addEventListener(`keydown`,i=>{(i.key===` `||i.key===`Enter`)&&(i.preventDefault(),requestPlaybackChange(activeTrack))}),dockedPlayer.volume.container.addEventListener(`auxclick`,i=>{i.preventDefault(),volume.level=volume.level<1?1:0,updateVolume()}),dockedPlayer.volume.container.addEventListener(`contextmenu`,i=>i.preventDefault()),dockedPlayer.volume.container.addEventListener(`mouseenter`,()=>{hoverAvailable()&&dockedPlayer.volume.container.classList.add(`hover`)}),dockedPlayer.volume.container.addEventListener(`mouseleave`,()=>{hoverAvailable()&&(dockedPlayer.volume.container.classList.remove(`hover`),dockedPlayer.volume.slider.classList.remove(`decrease`,`increase`))}),dockedPlayer.volume.container.addEventListener(`wheel`,i=>{i.preventDefault(),volume.finegrained?(volume.level+=i.deltaY*-1e-4,volume.level>1?volume.level=1:volume.level<0&&(volume.level=0)):i.deltaY<0?volume.level=1:i.deltaY>0&&(volume.level=0),updateVolume()}),dockedPlayer.volume.knob.addEventListener(`click`,()=>{hoverAvailable()||!volume.finegrained?toggleMute():dockedPlayer.volume.container.classList.toggle(`hover`)}),dockedPlayer.volume.knob.addEventListener(`keydown`,i=>{if(i.key===`ArrowDown`)volume.level-=.02;else if(i.key===`ArrowUp`)volume.level+=.02;else return;volume.level>1?volume.level=1:volume.level<0&&(volume.level=0),updateVolume(),i.preventDefault(),i.stopPropagation()}),dockedPlayer.volume.slider.addEventListener(`mousedown`,i=>{if(i.button===0){let O=i=>{let O=dockedPlayer.volume.sliderSvg.getBoundingClientRect(),k=Math.min(Math.max(0,i.clientX-O.x),O.width);volume.level=k/O.width,updateVolume()};O(i),window.addEventListener(`mousemove`,O),dockedPlayer.volume.slider.classList.add(`dragging`),window.addEventListener(`mouseup`,()=>{window.removeEventListener(`mousemove`,O),dockedPlayer.volume.slider.classList.remove(`dragging`)},{once:!0})}}),dockedPlayer.volume.slider.addEventListener(`mousemove`,i=>{let O=dockedPlayer.volume.sliderSvg.getBoundingClientRect(),k=Math.min(Math.max(0,i.clientX-O.x),O.width),A=k/O.width;A>volume.level?(dockedPlayer.volume.slider.classList.remove(`decrease`),dockedPlayer.volume.slider.classList.add(`increase`),dockedPlayer.volume.slider.querySelector(`linearGradient#gradient_level_increase stop:nth-child(1)`).setAttribute(`offset`,A),dockedPlayer.volume.slider.querySelector(`linearGradient#gradient_level_increase stop:nth-child(2)`).setAttribute(`offset`,A+1e-4)):(dockedPlayer.volume.slider.classList.remove(`increase`),dockedPlayer.volume.slider.classList.add(`decrease`),dockedPlayer.volume.slider.querySelector(`linearGradient#gradient_level_decrease stop:nth-child(1)`).setAttribute(`offset`,A),dockedPlayer.volume.slider.querySelector(`linearGradient#gradient_level_decrease stop:nth-child(2)`).setAttribute(`offset`,A+1e-4))});const handleTouch=i=>{for(let O of i.changedTouches){let i=dockedPlayer.volume.sliderSvg.getBoundingClientRect(),k=Math.min(Math.max(0,O.clientX-i.x),i.width);volume.level=k/i.width,updateVolume()}};dockedPlayer.volume.slider.addEventListener(`touchcancel`,handleTouch),dockedPlayer.volume.slider.addEventListener(`touchend`,handleTouch),dockedPlayer.volume.slider.addEventListener(`touchmove`,handleTouch),dockedPlayer.volume.slider.addEventListener(`touchstart`,handleTouch),dockedPlayer.volume.sliderInput.addEventListener(`blur`,()=>{dockedPlayer.volume.slider.classList.remove(`focus`)}),dockedPlayer.volume.sliderInput.addEventListener(`focus`,()=>{dockedPlayer.volume.slider.classList.add(`focus`)}),dockedPlayer.volume.sliderInput.addEventListener(`input`,()=>{volume.level=parseFloat(dockedPlayer.volume.sliderInput.valueAsNumber),updateVolume()}),dockedPlayer.volume.sliderInput.addEventListener(`keydown`,i=>{if(i.key===`ArrowLeft`||i.key===`ArrowDown`)volume.level-=.02;else if(i.key===`ArrowRight`||i.key===`ArrowUp`)volume.level+=.02;else if(i.key===`Enter`||i.key===` `)toggleMute();else return;volume.level>1?volume.level=1:volume.level<0&&(volume.level=0),updateVolume(),i.preventDefault()}),dockedPlayer.volume.sliderInput.addEventListener(`wheel`,i=>i.preventDefault()),listenButton.addEventListener(`click`,()=>{requestPlaybackChange(activeTrack)}),navigator.mediaSession&&(navigator.mediaSession.setActionHandler(`play`,()=>{requestPlaybackChange(activeTrack)}),navigator.mediaSession.setActionHandler(`pause`,()=>{requestPlaybackChange(activeTrack)}));const resizeObserver=new ResizeObserver(i=>{let O=i.reduce((i,O)=>Math.min(O.contentRect.width,i),1/0);waveforms(O)});let previousTrack=null,trackIndex=0;for(let i of document.querySelectorAll(`.track`)){let k=i.querySelector(`.artists`),A=i.querySelector(`audio`),j=i.querySelector(`.number`),M=i.querySelector(`.track_playback`),I=i.querySelector(`.track_playback .icon`),z=i.querySelector(`.title`),V=parseFloat(i.dataset.duration),W={artists:k,audio:A,container:i,duration:V,number:j,playbackButton:M,playbackButtonIcon:I,title:z};A.muted=!0,M.tabIndex=0,previousTrack!==null&&(previousTrack.nextTrack=W),previousTrack=W,A.addEventListener(`ended`,i=>{W.nextTrack?requestPlaybackChange(W.nextTrack):(reset(W),document.body.classList.remove(`player_active`),dockedPlayer.status.setAttribute(`aria-label`,PLAYER_JS_T.playerClosed),setActive(tracks[0]))}),A.addEventListener(`pause`,O=>{W.solicitedPlayback&&(delete W.solicitedPlayback,W.audio.muted=!0,clearInterval(globalUpdatePlayHeadInterval),i.classList.remove(`playing`),dockedPlayer.playbackButton.replaceChildren(playIcon.cloneNode(!0)),listenButtonIcon.replaceChildren(playIcon.cloneNode(!0)),listenButtonLabel.textContent=PLAYER_JS_T.listen,W.playbackButtonIcon.replaceChildren(playIcon.cloneNode(!0)),W.onPause?(W.onPause(),delete W.onPause):(updatePlayhead(W),announcePlayhead(W)))}),A.addEventListener(`play`,O=>{if(!W.solicitedPlayback){A.pause();return}i.classList.add(`playing`),dockedPlayer.playbackButton.replaceChildren(pauseIcon.cloneNode(!0)),listenButtonIcon.replaceChildren(pauseIcon.cloneNode(!0)),listenButtonLabel.textContent=PLAYER_JS_T.pause,W.playbackButtonIcon.replaceChildren(pauseIcon.cloneNode(!0)),globalUpdatePlayHeadInterval=setInterval(()=>updatePlayhead(W),1e3/24),updatePlayhead(W),announcePlayhead(W)}),A.addEventListener(`playing`,i=>{W.solicitedPlayback&&(dockedPlayer.playbackButton.replaceChildren(pauseIcon.cloneNode(!0)),listenButtonIcon.replaceChildren(pauseIcon.cloneNode(!0)),listenButtonLabel.textContent=PLAYER_JS_T.pause,W.playbackButtonIcon.replaceChildren(pauseIcon.cloneNode(!0)))}),A.addEventListener(`waiting`,i=>{W.solicitedPlayback&&(dockedPlayer.playbackButton.replaceChildren(loadingIcon.cloneNode(!0)),listenButtonIcon.replaceChildren(loadingIcon.cloneNode(!0)),listenButtonLabel.textContent=PLAYER_JS_T.pause,W.playbackButtonIcon.replaceChildren(loadingIcon.cloneNode(!0)))}),W.playbackButton.addEventListener(`click`,i=>{i.preventDefault(),requestPlaybackChange(W)}),i.addEventListener(`keydown`,i=>{if(i.key===`ArrowLeft`){i.preventDefault();let O=Math.max(0,W.audio.currentTime-5);requestSeek(W,O)}else if(i.key===`ArrowRight`){i.preventDefault();let O=Math.min(W.duration-1,W.audio.currentTime+5);requestSeek(W,O)}});let G=i.querySelector(`.waveform`);if(G){let i=G.querySelector(`.waveform input`),k=G.querySelector(`.waveform svg`),A=decode(k.dataset.peaks).map(i=>i/63);W.waveform={container:G,input:i,peaks:A,svg:k},W.waveform.container.addEventListener(`click`,i=>{let O=(i.clientX-W.waveform.input.getBoundingClientRect().x)/W.waveform.input.getBoundingClientRect().width,k=O*W.waveform.input.max;requestSeek(W,k),W.waveform.input.classList.add(`focus_from_click`),W.waveform.input.focus()}),W.waveform.container.addEventListener(`mouseenter`,i=>{W.waveform.container.classList.add(`seek`)}),W.waveform.container.addEventListener(`mousemove`,i=>{let O=(i.clientX-W.waveform.container.getBoundingClientRect().x)/W.waveform.container.getBoundingClientRect().width;W.waveform.svg.querySelector(`linearGradient.seek stop:nth-child(1)`).setAttribute(`offset`,O),W.waveform.svg.querySelector(`linearGradient.seek stop:nth-child(2)`).setAttribute(`offset`,O+1e-4)}),W.waveform.container.addEventListener(`mouseout`,i=>{W.waveform.container.classList.remove(`seek`)}),W.waveform.input.addEventListener(`blur`,()=>{W.waveform.input.classList.remove(`focus_from_click`)}),W.waveform.input.addEventListener(`focus`,()=>{announcePlayhead(W)}),W.waveform.input.addEventListener(`keydown`,i=>{(i.key===` `||i.key===`Enter`)&&(i.preventDefault(),requestPlaybackChange(W))});let j=`http://www.w3.org/2000/svg`;k.setAttribute(`xmlns`,j),k.setAttribute(`height`,`${TRACK_HEIGHT_EM}em`);let M=document.createElementNS(j,`defs`),N=document.createElementNS(j,`linearGradient`);N.classList.add(`playback`),N.id=`gradient_playback_${trackIndex}`;let P=document.createElementNS(j,`stop`);P.setAttribute(`offset`,`0`),P.setAttribute(`stop-color`,`var(--fg-1)`);let F=document.createElementNS(j,`stop`);F.setAttribute(`offset`,`0.000001`),F.setAttribute(`stop-color`,`hsla(0, 0%, 0%, 0)`),N.append(P,F);let I=document.createElementNS(j,`linearGradient`);I.classList.add(`seek`),I.id=`gradient_seek_${trackIndex}`;let L=document.createElementNS(j,`stop`);L.setAttribute(`offset`,`0`),L.setAttribute(`stop-color`,`var(--fg-3)`);let R=document.createElementNS(j,`stop`);R.setAttribute(`offset`,`0.000001`),R.setAttribute(`stop-color`,`hsla(0, 0%, 0%, 0)`),I.append(L,R),M.append(N),M.append(I),k.prepend(M),k.querySelector(`path.playback`).setAttribute(`stroke`,`url(#gradient_playback_${trackIndex})`),k.querySelector(`path.seek`).setAttribute(`stroke`,`url(#gradient_seek_${trackIndex})`);let z=W.waveform.container.parentElement;resizeObserver.observe(z)}trackIndex++,tracks.push(W)}window.addEventListener(`hashchange`,i=>{let O=parseHashParams();O&&(requestSeek(O.track,O.time??0),O.track.playbackButton.focus(),history.replaceState(null,``,` `),i.preventDefault())}),window.addEventListener(`keydown`,i=>{if(i.key===`m`){let{target:O}=i;(O.tagName!==`INPUT`||O.type!==`search`&&O.type!==`text`)&&(toggleMute(),i.preventDefault())}});const params=parseHashParams();params?(setActive(params.track),params.time!==void 0&&(params.track.seekTo=params.time),open(params.track),dockedPlayer.status.setAttribute(`aria-label`,PLAYER_JS_T.playerOpenWithXxx(params.track.title.textContent))):setActive(tracks[0]);const waveformRenderState={widthRem:0};function waveforms(O){let N=parseFloat(window.getComputedStyle(document.documentElement).getPropertyValue(`font-size`).replace(`px`,``)),P=(O-WAVEFORM_WIDTH_PADDING_REM)/N,F=P>BREAKPOINT_REDUCED_WAVEFORM_REM&&!document.querySelector(`[data-disable-relative-waveforms]`);if(waveformRenderState.widthRem>=P-WAVEFORM_WIDTH_TOLERANCE_REM&&waveformRenderState.widthRem<=P+WAVEFORM_WIDTH_TOLERANCE_REM)return;let I=parseFloat(document.querySelector(`[data-longest-duration]`).dataset.longestDuration);for(let i of tracks){let O=i.waveform.peaks,j=parseFloat(i.waveform.input.max),M=P;F&&(M*=j/I);let L=Math.round(.75*M*N),R=Math.min(L,O.length),z=WAVEFORM_PADDING_EM+(1-O[0])*WAVEFORM_HEIGHT,B=`M 0,${z.toFixed(2)}`,V=!1;for(let i=1;i<R;i+=1){let j=i/(R-1),N=j*(O.length-1),P=Math.floor(N),F=Math.ceil(N),I;if(P===F)I=O[P];else{let i=N-P;I=O[P]*(1-i)+O[F]*i}let L=j*M,V=WAVEFORM_PADDING_EM+(1-I)*WAVEFORM_HEIGHT,H=V===z?`1`:``;B+=` L ${L.toFixed(2)},${V.toFixed(2)}${H}`}let H=i.waveform.svg;H.setAttribute(`viewBox`,`0 0 ${M} 1.5`),H.setAttribute(`width`,`${M}em`),H.querySelector(`path.base`).setAttribute(`d`,B),H.querySelector(`path.playback`).setAttribute(`d`,B),H.querySelector(`path.seek`).setAttribute(`d`,B)}waveformRenderState.widthRem=P}